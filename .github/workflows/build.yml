name: Build CLI Todo App

on:
  push:
    branches: [ main ]
  workflow_dispatch:  # Позволяет запускать вручную

jobs:
  build:
    runs-on: ubuntu-latest  # ВАЖНО: latest вместо 20.04!
    
    steps:
    - name: 📥 Checkout code
      uses: actions/checkout@v4
    
    - name: ☕ Setup Java 8
      uses: actions/setup-java@v4
      with:
        java-version: '8'
        distribution: 'temurin'  # Используем Temurin (Adoptium)
    
    - name: 🔍 Check versions
      run: |
        echo "=== Environment Info ==="
        echo "Java version:"
        java -version
        echo ""
        echo "Maven version:"
        mvn --version
        echo ""
        echo "Working directory:"
        pwd
        ls -la
    
    - name: 🔨 Build project
      run: |
        echo "=== Building project ==="
        mvn clean compile
        echo "✅ Compilation successful!"
    
    - name: 🧪 Run tests
      run: |
        echo "=== Running tests ==="
        mvn test || echo "⚠️  Tests failed or not found"
    
    - name: 📦 Create JAR
      run: |
        echo "=== Creating JAR ==="
        mvn package -DskipTests
        echo "✅ JAR created successfully!"
    
    - name: 🎉 Success
      run: |
        echo "=== BUILD SUCCESSFUL! ==="
        echo "✅ All steps completed!"
        echo "📊 Java: 8"
        echo "🖥️  OS: Ubuntu latest"
        echo "📦 JAR files in target/:"
        ls -la target/*.jar 2>/dev/null || echo "No JAR files found"
